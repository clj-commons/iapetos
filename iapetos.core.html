<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>iapetos.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">iapetos</span> <span class="project-version">0.1.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>iapetos</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>collector</span></div></div></li><li class="depth-3 branch"><a href="iapetos.collector.exceptions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exceptions</span></div></a></li><li class="depth-3 branch"><a href="iapetos.collector.fn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fn</span></div></a></li><li class="depth-3 branch"><a href="iapetos.collector.jvm.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jvm</span></div></a></li><li class="depth-3"><a href="iapetos.collector.ring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ring</span></div></a></li><li class="depth-2 branch current"><a href="iapetos.core.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="iapetos.export.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>export</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="iapetos.core.html#var-collector-registry"><div class="inner"><span>collector-registry</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-counter"><div class="inner"><span>counter</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-dec"><div class="inner"><span>dec</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-gauge"><div class="inner"><span>gauge</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-histogram"><div class="inner"><span>histogram</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-inc"><div class="inner"><span>inc</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-observe"><div class="inner"><span>observe</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-register"><div class="inner"><span>register</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-register-as"><div class="inner"><span>register-as</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-set"><div class="inner"><span>set</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-set-to-current-time"><div class="inner"><span>set-to-current-time</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-start-timer"><div class="inner"><span>start-timer</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-subsystem"><div class="inner"><span>subsystem</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-summary"><div class="inner"><span>summary</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-value"><div class="inner"><span>value</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-activity-counter"><div class="inner"><span>with-activity-counter</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-counter"><div class="inner"><span>with-counter</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-counters"><div class="inner"><span>with-counters</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-duration"><div class="inner"><span>with-duration</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-failure-counter"><div class="inner"><span>with-failure-counter</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-failure-timestamp"><div class="inner"><span>with-failure-timestamp</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-success-counter"><div class="inner"><span>with-success-counter</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-success-timestamp"><div class="inner"><span>with-success-timestamp</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-timestamp"><div class="inner"><span>with-timestamp</span></div></a></li><li class="depth-1"><a href="iapetos.core.html#var-with-timestamps"><div class="inner"><span>with-timestamps</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">iapetos.core</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-collector-registry"><h3>collector-registry</h3><div class="usage"><code>(collector-registry)</code><code>(collector-registry registry-name)</code></div><div class="doc"><div class="markdown"><p>Create a fresh iapetos collector registry.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L21">view source</a></div></div><div class="public anchor" id="var-counter"><h3>counter</h3><div class="usage"><code>(counter metric &amp; [{:keys [description labels lazy?], :or {description "a counter metric."}, :as options}])</code></div><div class="doc"><div class="markdown"><p>Create a new <code>Counter</code> collector:</p>
<ul>
  <li><code>:description</code>: a description for the counter,</li>
  <li><code>:labels</code>: a seq of available labels for the counter,</li>
  <li><code>:lazy?</code> whether to immediately register the given metric with a registry  or not.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L53">view source</a></div></div><div class="public anchor" id="var-dec"><h3>dec</h3><div class="usage"><code>(dec collector)</code><code>(dec collector amount)</code><code>(dec registry metric)</code><code>(dec registry metric amount)</code><code>(dec registry metric labels)</code><code>(dec registry metric labels amount)</code></div><div class="doc"><div class="markdown"><p>Decrement the given metric by the given amount. This can be either called using a registry and metric name or directly on a collector:</p>
<pre><code>(-&gt; registry (inc :app/active-users-total))
(-&gt; registry :app/active-users-total (inc))
</code></pre>
<p>The return value of this operation is either the collector or registry that was passed in.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L202">view source</a></div></div><div class="public anchor" id="var-gauge"><h3>gauge</h3><div class="usage"><code>(gauge metric &amp; [{:keys [description labels lazy?], :or {description "a gauge metric."}, :as options}])</code></div><div class="doc"><div class="markdown"><p>Create a new <code>Gauge</code> collector:</p>
<ul>
  <li><code>:description</code>: a description for the gauge,</li>
  <li><code>:labels</code>: a seq of available labels for the gauge,</li>
  <li><code>:lazy?</code> whether to immediately register the given metric with a registry  or not.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L69">view source</a></div></div><div class="public anchor" id="var-histogram"><h3>histogram</h3><div class="usage"><code>(histogram metric &amp; [{:keys [description buckets labels lazy?], :or {description "a histogram metric."}, :as options}])</code></div><div class="doc"><div class="markdown"><p>Create a new <code>Histogram</code> collector:</p>
<ul>
  <li><code>:description</code>: a description for the histogram,</li>
  <li><code>:buckets</code>: a seq of double values describing the histogram buckets,</li>
  <li><code>:labels</code>: a seq of available labels for the histogram,</li>
  <li><code>:lazy?</code> whether to immediately register the given metric with a registry  or not.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L85">view source</a></div></div><div class="public anchor" id="var-inc"><h3>inc</h3><div class="usage"><code>(inc collector)</code><code>(inc collector amount)</code><code>(inc registry metric)</code><code>(inc registry metric amount)</code><code>(inc registry metric labels)</code><code>(inc registry metric labels amount)</code></div><div class="doc"><div class="markdown"><p>Increment the given metric by the given amount. This can be either called using a registry and metric name or directly on a collector:</p>
<pre><code>(-&gt; registry (inc :app/active-users-total))
(-&gt; registry :app/active-users-total (inc))
</code></pre>
<p>The return value of this operation is either the collector or registry that was passed in.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L166">view source</a></div></div><div class="public anchor" id="var-observe"><h3>observe</h3><div class="usage"><code>(observe collector amount)</code><code>(observe registry metric amount)</code><code>(observe registry metric labels amount)</code></div><div class="doc"><div class="markdown"><p>Observe the given amount for the desired metric. This can be either called using a registry and metric name or directly on a collector:</p>
<pre><code>(-&gt; registry (observe :app/active-users-total 10.0))
(-&gt; registry :app/active-users-total (observe 10.0))
</code></pre>
<p>The return value of this operation is either the collector or registry that was passed in.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L145">view source</a></div></div><div class="public anchor" id="var-register"><h3>register</h3><div class="usage"><code>(register registry &amp; collectors)</code></div><div class="doc"><div class="markdown"><p>Register the given collectors.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L26">view source</a></div></div><div class="public anchor" id="var-register-as"><h3>register-as</h3><div class="usage"><code>(register-as registry metric collector)</code></div><div class="doc"><div class="markdown"><p>Register the given collector under the given metric name. This is useful for plain Prometheus collectors, i.e. those that are not provided by iapetos.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L37">view source</a></div></div><div class="public anchor" id="var-set"><h3>set</h3><div class="usage"><code>(set collector amount)</code><code>(set registry metric amount)</code><code>(set registry metric labels amount)</code></div><div class="doc"><div class="markdown"><p>Set the given metric to the given value. This can be either called using a registry and metric name or directly on a collector:</p>
<pre><code>(-&gt; registry (set :app/active-users-total 10.0))
(-&gt; registry :app/active-users-total (set 10.0))
</code></pre>
<p>The return value of this operation is either the collector or registry that was passed in.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L238">view source</a></div></div><div class="public anchor" id="var-set-to-current-time"><h3>set-to-current-time</h3><div class="usage"><code>(set-to-current-time collector)</code><code>(set-to-current-time registry metric)</code><code>(set-to-current-time registry metric labels)</code></div><div class="doc"><div class="markdown"><p>Set the given metric to the current timestamp. This can be either called using a registry and metric name or directly on a collector:</p>
<pre><code>(-&gt; registry (set-to-current-time :app/last-success-unixtime))
(-&gt; registry :app/last-success-unixtime set-to-current-time)
</code></pre>
<p>The return value of this operation is either the collector or registry that was passed in.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L259">view source</a></div></div><div class="public anchor" id="var-start-timer"><h3>start-timer</h3><div class="usage"><code>(start-timer collector)</code><code>(start-timer registry metric)</code><code>(start-timer registry metric labels)</code></div><div class="doc"><div class="markdown"><p>Start a timer that, when stopped, will store the duration in the given metric. This can be either called using a registry and metric name or a collector:</p>
<pre><code>(-&gt; registry (start-timer :app/duration-seconds))
(-&gt; registry :app/duration-seconds (start-timer))
</code></pre>
<p>The return value will be a <em>function</em> that should be called once the operation to time has run.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L280">view source</a></div></div><div class="public anchor" id="var-subsystem"><h3>subsystem</h3><div class="usage"><code>(subsystem registry subsystem-name)</code></div><div class="doc"><div class="markdown"><p>Create a new registry bound to the given subsystem. The resulting value will not have access to any of the original registryâ€™s collectors.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L44">view source</a></div></div><div class="public anchor" id="var-summary"><h3>summary</h3><div class="usage"><code>(summary metric &amp; [{:keys [description labels lazy?], :or {description "a summary metric."}, :as options}])</code></div><div class="doc"><div class="markdown"><p>Create a new <code>Summary</code> collector:</p>
<ul>
  <li><code>:description</code>: a description for the summary,</li>
  <li><code>:labels</code>: a seq of available labels for the summary,</li>
  <li><code>:lazy?</code> whether to immediately register the given metric with a registry  or not.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L105">view source</a></div></div><div class="public anchor" id="var-value"><h3>value</h3><div class="usage"><code>(value collector)</code><code>(value registry metric)</code><code>(value registry metric labels)</code></div><div class="doc"><div class="markdown"><p>Read the current value of a metric. This can be either called using a registry and a metric name or directly on a collector:</p>
<pre><code>(-&gt; registry (value :app/duration-seconds))
(-&gt; registry :app/duration-seconds (value))
</code></pre>
<p>The return value depends on the type of collector.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L300">view source</a></div></div><div class="public anchor" id="var-with-activity-counter"><h3>with-activity-counter</h3><h4 class="type">macro</h4><div class="usage"><code>(with-activity-counter collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to increment the given collector once it is entered and decrement it once execution is done. This needs a <a href="iapetos.core.html#var-gauge">gauge</a> collector (since <a href="iapetos.core.html#var-counter">counter</a> ones cannot be decremented).</p>
<p>Example: Counting the number of in-flight requests in an HTTP server.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L362">view source</a></div></div><div class="public anchor" id="var-with-counter"><h3>with-counter</h3><h4 class="type">macro</h4><div class="usage"><code>(with-counter collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to increment the given counter once it is done.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L322">view source</a></div></div><div class="public anchor" id="var-with-counters"><h3>with-counters</h3><h4 class="type">macro</h4><div class="usage"><code>(with-counters {:keys [total success failure], :as counters} &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to increment the given counters:</p>
<ul>
  <li><code>:total</code>: incremented when the block is left,</li>
  <li><code>:success</code>: incremented when the block has executed successfully,</li>
  <li><code>:failure</code>: incremented when the block has thrown an exception.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L348">view source</a></div></div><div class="public anchor" id="var-with-duration"><h3>with-duration</h3><h4 class="type">macro</h4><div class="usage"><code>(with-duration collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to write its execution time to the given collector.</p>
<p>Works with <a href="iapetos.core.html#var-gauge">gauge</a>, <a href="iapetos.core.html#var-histogram">histogram</a> and <a href="iapetos.core.html#var-summary">summary</a> collectors.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L428">view source</a></div></div><div class="public anchor" id="var-with-failure-counter"><h3>with-failure-counter</h3><h4 class="type">macro</h4><div class="usage"><code>(with-failure-counter collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to increment the given counter if it throws.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L339">view source</a></div></div><div class="public anchor" id="var-with-failure-timestamp"><h3>with-failure-timestamp</h3><h4 class="type">macro</h4><div class="usage"><code>(with-failure-timestamp collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to store the current timestamp in the given collector once execution has failed.</p>
<p>Needs a <a href="iapetos.core.html#var-gauge">gauge</a> collector.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L399">view source</a></div></div><div class="public anchor" id="var-with-success-counter"><h3>with-success-counter</h3><h4 class="type">macro</h4><div class="usage"><code>(with-success-counter collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to increment the given counter once it has run successfully.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L331">view source</a></div></div><div class="public anchor" id="var-with-success-timestamp"><h3>with-success-timestamp</h3><h4 class="type">macro</h4><div class="usage"><code>(with-success-timestamp collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to store the current timestamp in the given collector once execution is done successfully.</p>
<p>Needs a <a href="iapetos.core.html#var-gauge">gauge</a> collector.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L389">view source</a></div></div><div class="public anchor" id="var-with-timestamp"><h3>with-timestamp</h3><h4 class="type">macro</h4><div class="usage"><code>(with-timestamp collector &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to store the current timestamp in the given collector once execution is done.</p>
<p>Needs a <a href="iapetos.core.html#var-gauge">gauge</a> collector.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L378">view source</a></div></div><div class="public anchor" id="var-with-timestamps"><h3>with-timestamps</h3><h4 class="type">macro</h4><div class="usage"><code>(with-timestamps {:keys [last-run last-success last-failure]} &amp; body)</code></div><div class="doc"><div class="markdown"><p>Wrap the given block to set a number of timestamps depending on whether execution succeeds or fails:</p>
<p><code>:last-run</code>: the last time the block was run, <code>:last-success</code>: the last time the block was run successfully, <code>:last-failure</code>: the last time execution failed.</p>
<p>All keys are optional but have to point at a <a href="iapetos.core.html#var-gauge">gauge</a> collector if given.</p></div></div><div class="src-link"><a href="https://github.com/xsc/iapetos/blob/v0.1.0-SNAPSHOT/src/iapetos/core.clj#L411">view source</a></div></div></div></body></html>